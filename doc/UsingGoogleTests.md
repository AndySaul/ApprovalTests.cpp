<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /doc/mdsource/UsingGoogleTests.source.md
To change this file edit the source file and then execute ./run_markdown_templates.sh.
-->

<a id="top"></a>

# Using Approval Tests With Google Tests

<!-- toc -->
## Contents

  * [Getting Started With Google Test](#getting-started-with-google-test)
    * [Starter Project](#starter-project)
    * [New Project](#new-project)
    * [Existing Project - no main()](#existing-project---no-main)
    * [Existing Project - with your main()](#existing-project---with-your-main)
  * [Customizing Google Tests Approval File Names](#customizing-google-tests-approval-file-names)
    * [Customizing](#customizing)
      * [# Custom Suffixes](#-custom-suffixes)
      * [# Custom Anything](#-custom-anything)
<!-- endtoc -->



## Getting Started With Google Test

The [Google Test](https://github.com/google/googletest) test framework works well with Approval Tests.

This section describes the various ways of using Approval Tests with Google Test.

### Starter Project

We haven't yet provided a Starter Project for using Approval Tests with Google Tests.

This is partly based on the assumption that anyone already using Google Tests will have their own project set up, and anyone else would probably use Catch 2 instead.
 
If it would be helpful for us to such a Starter Project, please let us know, via the contact details in [Contributing to ApprovalTests.cpp](/doc/Contributing.md#top). 


### New Project

Create a file `main.cpp` and add just the following two lines:

<!-- snippet: googletest_main -->
<a id='snippet-googletest_main'/></a>
```cpp
// main.cpp:
#define APPROVALS_GOOGLETEST // This tells Approval Tests to provide a main() - only do this in one cpp file
#include "ApprovalTests.hpp"
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/main.cpp#L2-L6) / [anchor](#snippet-googletest_main)</sup>
<!-- endsnippet -->

### Existing Project - no main()

Google Test has a `gtest_main` library that provides a `main()` function, and then runs all your tests.

If your existing Google Test application uses the `gtest_main` library, Approval Tests will not be able to obtain the names to use output files. You will then see the help message shown in [Troubleshooting](/doc/Troubleshooting.md#top).

To fix this, please add a new `main.cpp`, as shown in the previous section.


### Existing Project - with your main()

If you have an existing Google Test-based test program that provides its own `main()`, you won't be able to use the approach above.

Instead, you should make the following additions to your own source file that contains `main()`.  

<!-- snippet: googletest_existing_main -->
<a id='snippet-googletest_existing_main'/></a>
```cpp
// main.cpp:

// 1. Add these two lines to your main:
#define APPROVALS_GOOGLETEST_EXISTING_MAIN
#include "ApprovalTests.hpp"

int main(int argc, char** argv)
{
    ::testing::InitGoogleTest(&argc, argv);
    
    // 2. Add this line to your main:
    initializeApprovalTestsForGoogleTests();

    return RUN_ALL_TESTS();
}
```
<sup>[snippet source](/examples/googletest_existing_main/main.cpp#L1-L17) / [anchor](#snippet-googletest_existing_main)</sup>
<!-- endsnippet -->

## Customizing Google Tests Approval File Names

Most testing frameworks have two pieces of naming information: `SourceFileName` and `TestName`.

Google Tests has an additional piece of information: `TestCaseName`.
 
<!-- snippet: googletest_name_parts -->
<a id='snippet-googletest_name_parts'/></a>
```cpp
TEST(TestCaseName, TestName)
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/GoogleFixtureNamerCustomizationTests.cpp#L11-L13) / [anchor](#snippet-googletest_name_parts)</sup>
<!-- endsnippet -->

With Google Tests, this will result in Approvals creating output files beginning with:

```
SourceFileName.TestCaseName.TestName
```

Very often, the `SourceFileName` and the `TestCaseName` are redundant, meaning that what you would like is:

```
SourceFileName.TestName
```

By default, Approval Tests will do this if `TestCaseName` is completely contained within `SourceFileName`, meaning it is a sub-string.

### Customizing

If this is not enough, Approvals allows for customization, in two ways.

**Note:** to be able to add these pieces of code outside of a function, you need to hold on to the result as a variable. This variable is not used, it is only there to allow the method to execute.

**Note:** using these customizations inside a Google `TEST` or `TEST_F`, is too late for that test: they won't take effect until the next executed test.

**Note:** this customization is permanent: it affects all tests run later in the current program run.

**Note:** this customization is cannot be reversed.

#### Custom Suffixes

For example, if you are Google test fixtures, you might have a lot of class names of the format `TestClassNameFixture`. You can tell Approval Tests that these are the same by adding the following to your main:

<!-- snippet: googletest_customize_suffix -->
<a id='snippet-googletest_customize_suffix'/></a>
```cpp
// main.cpp
auto customization = GoogleConfiguration::addIgnorableTestCaseNameSuffix("Fixture");
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/GoogleFixtureNamerCustomizationTests.cpp#L6-L9) / [anchor](#snippet-googletest_customize_suffix)</sup>
<!-- endsnippet -->

#### Custom Anything

If you have something more unique, you can write a function that will match if the test case name and the source file names should be considered equal.

For example, let's say you want a special tag `IgnoreThis` to indicate a that a TestCaseName should be ignored, when determining the names of output files.

So:

<!-- snippet: googletest_customize_test -->
<a id='snippet-googletest_customize_test'/></a>
```cpp
TEST(TestCaseName_IgnoreThis, TestName )
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/GoogleFixtureNamerCustomizationTests.cpp#L52-L54) / [anchor](#snippet-googletest_customize_test)</sup>
<!-- endsnippet -->

Would produce an output file beginning with:

<!-- snippet: googletest_customize_test_name -->
<a id='snippet-googletest_customize_test_name'/></a>
```cpp
auto outputFileBaseName = "GoogleFixtureNamerCustomizationTests.TestName";
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/GoogleFixtureNamerCustomizationTests.cpp#L58-L60) / [anchor](#snippet-googletest_customize_test_name)</sup>
<!-- endsnippet -->

You could achieve this by registering a function pointer like this:

<!-- snippet: googletest_customize_function -->
<a id='snippet-googletest_customize_function'/></a>
```cpp
// main.cpp
bool dropTestCaseNamesWithIgnoreThis(const std::string& /*testFileNameWithExtension*/, const std::string& testCaseName)
{
    return StringUtils::contains(testCaseName, "IgnoreThis");
}

auto ignoreNames = GoogleConfiguration::addTestCaseNameRedundancyCheck(dropTestCaseNamesWithIgnoreThis);
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/GoogleFixtureNamerCustomizationTests.cpp#L33-L41) / [anchor](#snippet-googletest_customize_function)</sup>
<!-- endsnippet -->

Or by using a lambda like this:

<!-- snippet: googletest_customize_lambda -->
<a id='snippet-googletest_customize_lambda'/></a>
```cpp
// main.cpp
auto ignoreNamesLambda = GoogleConfiguration::addTestCaseNameRedundancyCheck(
    [](const std::string& /*testFileNameWithExtension*/, const std::string& testCaseName)
    {
        return StringUtils::contains(testCaseName, "IgnoreThis");
    });
```
<sup>[snippet source](/ApprovalTests_GoogleTest_Tests/GoogleFixtureNamerCustomizationTests.cpp#L43-L50) / [anchor](#snippet-googletest_customize_lambda)</sup>
<!-- endsnippet -->


---

[Back to User Guide](/doc/README.md#top)
